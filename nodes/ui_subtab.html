<script type="text/javascript">
    // convert to i18 text
    function c_ui_subtab(x) {
        return RED._("node-red-uc-dashboard/ui_subtab:ui_subtab."+x);
    }

    RED.nodes.registerType('ui_subtab',{
        category: 'config',
        defaults: {
            name: {value: c_ui_subtab("label.default")},
            icon: {value: 'folder'},
            tab: {type:"ui_tab", required: true },
            order: {value: 0},
            disp: {value: true},
            width: {value: 6},
            collapse: {value: false},
            disabled: {value: false},
            hidden: {value: false}
        },
        sort: function(A,B) {
            if (A.tab !== B.tab) {
                var tabA = RED.nodes.node(A.tab);
                var tabB = RED.nodes.node(B.tab);
                if (!tabA && tabB) {
                    return -1;
                }
                else if (tabA && !tabB) {
                    return 1;
                }
                else {
                    return tabA.order - tabB.order;
                }
            }
            return A.order - B.order;
        },
        paletteLabel: 'dashboard subtab',
        label: function() {
            var tabNode = RED.nodes.node(this.tab);
            if (tabNode) {
                return "["+(tabNode.name||c_ui_subtab("label.tab"))+"] " + (this.name || c_ui_subtab("label.subtab"));
            }
            return "["+c_ui_subtab("label.unassigned")+"] " + (this.name || c_ui_subtab("label.subtab"));
        },
        // labelStyle: function() { return this.name?"node_label_italic":""; },
        oneditprepare: function() {
            // $("#node-input-size").elementSizer({
            //     width: "#node-config-input-width",
            //     auto: false
            // });
            // $("#node-config-input-disp").on("change", function() {
            //     if ($("#node-config-input-disp").is(":checked")) {
            //         $("#subtab-collapse-flag").show();
            //     }
            //     else {
            //         $("#subtab-collapse-flag").hide();
            //         $("#node-config-input-collapse").prop("checked",false);
            //     }
            // });
            $("#node-config-input-disabled-btn").on("click", function(e) {
              var i = $(this).find("i");
              var active = i.hasClass("fa-toggle-on");
              var newCls = "fa fa-toggle-" + (active ? "off" : "on");
              i.attr("class", newCls);
              $("#node-config-input-disabled").prop('checked',active);

              var newTxt = c_ui_tab(active ? "label.disabled" : "label.enabled");
              $("#node-config-input-disabled-label").text(newTxt);

              var info = $("#node-config-input-disabled-info");
              var done = active ? info.show() : info.hide();
          });
          if (this.disabled) {
              $("#node-config-input-disabled-btn").click();
          }
          else {
              $("#node-config-input-disabled-label").text(c_ui_tab("label.enabled"));
          }

          $("#node-config-input-hidden-btn").on("click", function(e) {
              var i = $(this).find("i");
              var active = i.hasClass("fa-toggle-on");
              var newCls = "fa fa-toggle-" + (active ? "off" : "on");
              i.attr("class", newCls);
              $("#node-config-input-hidden").prop('checked',active);

              var newTxt = c_ui_tab(active ? "label.hidden" : "label.visible");
              $("#node-config-input-hidden-label").text(newTxt);

              var info = $("#node-config-input-hidden-info");
              var done = active ? info.show() : info.hide();
          });
          if (this.hidden) {
              $("#node-config-input-hidden-btn").click();
          }
          else {
              $("#node-config-input-hidden-label").text(c_ui_tab("label.visible"));
          }
        },
        oneditsave: function() {
          this.disabled = $("#node-config-input-disabled").prop("checked");
          this.hidden = $("#node-config-input-hidden").prop("checked");
      }
    });
</script>

<script type="text/html" data-template-name="ui_subtab">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="ui_subtab.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>
    <div class="form-row">
        <label for="node-config-input-icon"><i class="fa fa-file-image-o"></i><span data-i18n="ui_subtab.label.icon"></span></label>
        <input type="text" id="node-config-input-icon">
    </div>
    <div class="form-row">
        <label for="node-config-input-tab"><i class="fa fa-table"></i> <span data-i18n="ui_subtab.label.tab"></span></label>
        <input type="text" id="node-config-input-tab">
    </div>
    <div class="form-row">
        <label for="node-config-input-disabled-btn"><i class="fa fa-ban"></i><span data-i18n="ui_subtab.label.state"></span></label>
        <button id="node-config-input-disabled-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-disabled-label"></span></button>
        <input type="checkbox" id="node-config-input-disabled" style="display: none;">
        <span id="node-config-input-disabled-info" data-i18n="[html]ui_subtab.info.disabled" style="display: none;"></span>
    </div>
    <div class="form-row">
        <label for="node-config-input-hidden-btn"><i class="fa fa-eye-slash"></i><span data-i18n="ui_subtab.label.navmenu"></span></label>
        <button id="node-config-input-hidden-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-hidden-label"></span></button>
        <input type="checkbox" id="node-config-input-hidden" style="display:none;">  
        <span id="node-config-input-hidden-info" data-i18n="[html]ui_subtab.info.hidden" style="display:none;"></span>
    </div>
    <div class="form-tips" data-i18n="[html]ui_subtab.tip"></div>
</script>

<script type="text/html" data-help-name="ui_tab">
    <p>Subab configuration for UC Dashboard</p>
    <p><b>Disabled</b> pages are not included in the Dashboard app, and are therefore not functional.
       The tab name still appears in the Navigation Menu (unless it is also hidden).
    </p>
    <p><b>Hidden</b> pages are not listed in the Left-hand Navigation Menu.
       However, they are still active in the Dashboard, and can be shown by using a `ui_control` msg.
    </p>
    <p>The <b>Icon</b> field can be either a <a href="https://klarsys.github.io/angular-material-icons/" target="_blank">Material Design icon</a>
    <i>(e.g. 'check', 'close')</i> or a <a href="https://fontawesome.com/v4.7.0/icons/" target="_blank">Font Awesome icon</a>
    <i>(e.g. 'fa-fire')</i>, or a <a href="https://github.com/Paul-Reed/weather-icons-lite/blob/master/css_mappings.md">Weather icon</a>.
    You can use the full set of google material icons if you add 'mi-' to the icon name. e.g. 'mi-videogame_asset'.</p>
  </script>